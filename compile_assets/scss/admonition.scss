////
/// Copyright (c) 2016-2022 Martin Donath <martin.donath@squidfunk.com>
///
/// Permission is hereby granted, free of charge, to any person obtaining a
/// copy of this software and associated documentation files (the "Software"),
/// to deal in the Software without restriction, including without limitation
/// the rights to use, copy, modify, merge, publish, distribute, sublicense,
/// and/or sell copies of the Software, and to permit persons to whom the
/// Software is furnished to do so, subject to the following conditions:
///
/// The above copyright notice and this permission notice shall be included in
/// all copies or substantial portions of the Software.
///
/// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
/// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
/// FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL
/// THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
/// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
/// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
/// DEALINGS
////

@use "sass:color";
@use "sass:list";

// ----------------------------------------------------------------------------
// Rules: layout
// ----------------------------------------------------------------------------

// Admonition
:is(.admonition) {
  display: flow-root;
  margin: 1.5625em 0;
  padding: 0 1.2rem;
  // variable provided downstream by mdbook
  color: var(--fg);
  // font-size: 1.2rem;
  page-break-inside: avoid;
  // variable provided downstream by mdbook
  background-color: var(--bg);
  border: 0 solid black;
  border-inline-start-width: 0.4rem;
  border-radius: 0.2rem;
  box-shadow:
    0 0.2rem 1rem rgba(0, 0, 0, 0.05),
    0 0 0.1rem rgba(0, 0, 0, 0.1);

  // [print]: Omit shadow as it may lead to rendering errors
  @media print {
    box-shadow: none;
  }

  // Hack: Chrome exhibits a weird issue where it will set nested elements to
  // content-box. Doesn't happen in other browsers, so looks like a bug.
  > * {
    box-sizing: border-box;
  }

  // Adjust vertical spacing for nested admonitions
  :is(.admonition) {
    margin-top: 1em;
    margin-bottom: 1em;
  }

  // Adjust spacing for single-child tabbed block container
  > .tabbed-set:only-child {
    margin-top: 0;
  }

  // Adjust spacing on last child
  html & > :last-child {
    margin-bottom: 1.2rem;
  }
}

// Anchor links
a.admonition-anchor-link {
  // Don't display the link by default
  display: none;

  // Position to the left of the element to link to
  position: absolute;
  left: -1.2rem;
  // Ensure we have enough padding, so that we can move the mouse to click on it
  padding-right: 1rem;

  &:link,
  &:visited {
    // Don't make links colored (override to standard text color)
    // variable provided downstream by mdbook
    color: var(--fg);
  }
  &:link:hover,
  &:visited:hover {
    // No underline on hover
    text-decoration: none;
  }

  &::before {
    content: "ยง";
  }
}

// Admonition title
:is(.admonition-title, summary.admonition-title) {
  position: relative;
  min-height: 4rem;
  margin-block: 0;
  margin-inline: -1.6rem -1.2rem;
  padding-block: 0.8rem;
  padding-inline: 4.4rem 1.2rem;
  font-weight: 700;
  background-color: color.adjust($clr-blue-a200, $alpha: -0.9);
  // Always print title bar tint
  print-color-adjust: exact;
  -webkit-print-color-adjust: exact;
  // Compatilility with rendering markdown inside the content
  display: flex;

  // Compatilility with rendering markdown inside the content
  & p {
    margin: 0;
  }

  // Adjust spacing for title-only admonitions
  html &:last-child {
    margin-bottom: 0;
  }

  // Admonition icon
  &::before {
    position: absolute;
    top: 0.625em;
    inset-inline-start: 1.6rem;
    width: 2rem;
    height: 2rem;
    background-color: $clr-blue-a200;
    // Always print icon
    print-color-adjust: exact;
    -webkit-print-color-adjust: exact;
    mask-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"></svg>');
    -webkit-mask-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"></svg>');
    mask-repeat: no-repeat;
    -webkit-mask-repeat: no-repeat;
    mask-size: contain;
    -webkit-mask-size: contain;
    content: "";
  }

  // Show anchor link on hover over title
  &:hover a.admonition-anchor-link {
    display: initial;
  }
}

summary.admonition-title {
  details.admonition > &::after {
    position: absolute;
    top: 0.625em;
    inset-inline-end: 1.6rem;
    height: 2rem;
    width: 2rem;
    background-color: currentcolor;
    mask-image: var(--md-details-icon);
    -webkit-mask-image: var(--md-details-icon);
    mask-repeat: no-repeat;
    -webkit-mask-repeat: no-repeat;
    mask-size: contain;
    -webkit-mask-size: contain;
    content: "";
    transform: rotate(0deg);
    transition: transform 0.25s;
  }

  details[open].admonition > &::after {
    transform: rotate(90deg);
  }
}

// ----------------------------------------------------------------------------
// Rules: themes
// ----------------------------------------------------------------------------
//
// One rule per builtin theme in mdbook, overriding the default fg/bg if matched

.navy {
  & :is(.admonition) {
    background-color: var(--sidebar-bg);
  }
}

.ayu,
.coal {
  & :is(.admonition) {
    background-color: var(--theme-hover);
  }
}

.rust {
  & :is(.admonition) {
    background-color: var(--sidebar-bg);
    color: var(--sidebar-fg);
  }

  & .admonition-anchor-link {
    &:link,
    &:visited {
      color: var(--sidebar-fg);
    }
  }
}
